function setcookie(e,o,t){var s=window.location.host;s=s.replace("http://",""),s=s.replace("www",""),s||(s=".miyabaobei.com"),document.cookie=e+"="+o+";path=/;domain="+s+";expires="+t+";"}function getcookie(e){var o=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return null!=o?unescape(o[2]):""}function logininfo(){$.ajax({url:"/login/info",type:"POST",context:document.body,dataType:"json",success:function(e){e.cart_num>0&&$("#cart_num").text(e.cart_num);var o=e.is_login;if(1==o){var t=e.username;t.length>8&&(t=t.substr(0,15)+".."),$("#logined").text(t),$("#unlogin").hide(),$(".logout").show()}else $("#unlogin").show(),$(".logout").hide()}})}function hpop(){var e=$("#hpop .sp"),o=$("body").width();e.length>0&&($("#hpop").css({height:"50px",width:o}),e.css({width:o,height:"50px"}),jQuery(document).ready(function(t){if(t(".mainHeader").hasClass("pull")){var s=new Image;e.attr("data-bimg")&&(s.src=e.attr("data-bimg"),t(s).load(function(){if(s.src){var e=t('<span style="background-image:url('+s.src+');background-repeat:no-repeat;background-position:center top;position:relative;background-color:#ff5521" />'),a=t('<span id="closehpop"></span>');a.appendTo(e).css({position:"absolute",bottom:"3px",left:(o-1e3)/2+1e3-80,color:"#000",display:"block",height:"40px",width:"60px",padding:"0 6px","line-height":"20px"}),t("body").delegate("#closehpop","click",function(o){o.preventDefault(),e.hide()}),e.css({width:o}).appendTo("#hpop .sp").eq(0).css({display:"block",height:"50px",position:"relative"}).animate({height:"545px"},400,"linear",function(){setTimeout(function(){e.slideUp(400)},6e3)})}}))}}))}var str=location.href,re=/from=([\w_\-\.\\\+\%]*)/i,rs=str.match(re),curUrl=window.location.href,from=curUrl.indexOf("from"),sugs={},sugsArray=[],parms=[],addons="",origin=curUrl,nextUrl="";if(curUrl.indexOf("?")>0){curUrl.indexOf("#")>0?(sugsArray=curUrl.split("?")[1].split("#")[0].split("&"),addons="#"+curUrl.split("#")[1]):sugsArray=curUrl.split("?")[1].split("&");for(var i=0;i<sugsArray.length;i++)if(sugsArray[i].indexOf("=")!=-1){var k=sugsArray[i].substr(0,sugsArray[i].indexOf("=")),v=sugsArray[i].substr(sugsArray[i].indexOf("=")+1);sugs[k]=v}origin=curUrl.split("?")[0]}else curUrl.indexOf("#")>0&&(addons="#"+curUrl.split("#")[1],origin=curUrl.split("#")[0]);if(from!=-1){var date=new Date;if(rs&&""!=sugs.from){var from_type=sugs.from.substr(0,2);if("2c"==from_type)var expireDays=14;else var expireDays=1;date.setTime(date.getTime()+24*expireDays*3600*1e3),setcookie("sitefrom",sugs.from,date.toGMTString());var webunion_stfrom=["duomai","yiqifa","cn360","linktech","chanet","chanetwap","zhituicps","weiyicps","1c00220000034200131054f19455ceb0a","shande","1c0022310003a4001c94551153736ca04","547bd910145f3","3c00228000042a003fbb553daa3592fc2","2c0012400003ce001cbf5523ab1fcacbe"];if("2c0012400003ce001cbf5523ab1fcacbe"==sugs.from&&(sugs.wu_source="bdmy",sugs.wu_channel="cps",sugs.wu_cid="",sugs.wu_wi="",""!=sugs.baidu_token&&"undefined"!=typeof sugs.baidu_token&&(sugs.wu_wi=sugs.baidu_token)),sugs.from&&webunion_stfrom.indexOf(sugs.from)!=-1){var date=new Date,expireDays=1;date.setTime(date.setTime(date.getTime()+24*expireDays*3600*1e3));var myreg=/^[a-zA-Z0-9\_\=\^\-\|]+$/;""!=sugs.wu_source&&"undefined"!=typeof sugs.wu_source&&myreg.test(sugs.wu_source)&&setcookie("web_union_source",sugs.wu_source,date.toGMTString()),""!=sugs.wu_channel&&"undefined"!=typeof sugs.wu_channel&&myreg.test(sugs.wu_channel)&&setcookie("web_union_channel",sugs.wu_channel,date.toGMTString()),""!=sugs.wu_cid&&"undefined"!=typeof sugs.wu_cid&&myreg.test(sugs.wu_cid)&&setcookie("web_union_cid",sugs.wu_cid,date.toGMTString()),""!=sugs.wu_wi&&"undefined"!=typeof sugs.wu_wi&&myreg.test(sugs.wu_wi)&&setcookie("web_union_wi",sugs.wu_wi,date.toGMTString()),""!=sugs.union_uid&&"undefined"!=typeof sugs.union_uid&&myreg.test(sugs.union_uid)&&setcookie("union_uid",sugs.union_uid,date.toGMTString()),""!=sugs.union_planid&&"undefined"!=typeof sugs.union_planid&&myreg.test(sugs.union_planid)&&setcookie("union_planid",sugs.union_planid,date.toGMTString())}}delete sugs.from;for(i in sugs)nextUrl+="&"+i+"="+sugs[i];nextUrl=nextUrl.length>0?"?"+nextUrl.substr(1):origin,""!=addons&&(nextUrl+=addons)}else{var last_url=document.referrer;if(""!=last_url){for(var urlReg=/[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+\.?/,url=urlReg.exec(last_url),domain=url[0],keyval=last_url.substr(last_url.indexOf("?")+1,last_url.length),arr=keyval.split("&"),miyauuid=getcookie("miyauuid"),sitefrom=getcookie("sitefrom"),siteforms=["2c009307000452003fe3557fb8185917d","2c009309000453003fe4557fbbe1d65f8","2c009310000454003fe5557fbc3331bb2","2c009311000455003fe6557fbc8340b5a","2c009312000456003fe7557fbd2534d53","2c009313000457003fe8557fbd9b32e30"],domain_names=["www.baidu.com","m.baidu.com","www.haosou.com","m.haosou.com","www.sogou.com","m.sogou.com","wap.sogou.com","cn.bing.com","m.bing.com","www.bing.com","www.google.com","m.sm.cn"],dataInfo=[],i=0;i<arr.length;i++){var splitInfo=arr[i].split("="),key=splitInfo[0],val=splitInfo[1];dataInfo[key]=val}if(domain_names.indexOf(domain)!=-1&&(siteforms.indexOf(sitefrom)!=-1||""==sitefrom)){var searchWord="",cookieval="",never=new Date;switch(never.setTime(never.getTime()+12096e5),domain){case"www.baidu.com":cookieval="2c009307000452003fe3557fb8185917d",searchWord=dataInfo.wd;break;case"m.baidu.com":cookieval="2c009307000452003fe3557fb8185917d",searchWord=dataInfo.word;break;case"www.haosou.com":cookieval="2c009309000453003fe4557fbbe1d65f8",searchWord=dataInfo.q;break;case"m.haosou.com":cookieval="2c009309000453003fe4557fbbe1d65f8",searchWord=dataInfo.q;break;case"www.sogou.com":cookieval="2c009310000454003fe5557fbc3331bb2",searchWord=dataInfo.query;break;case"m.sogou.com":cookieval="2c009310000454003fe5557fbc3331bb2",searchWord=dataInfo.keyword;break;case"wap.sogou.com":cookieval="2c009310000454003fe5557fbc3331bb2",searchWord=dataInfo.keyword;break;case"cn.bing.com":cookieval="2c009311000455003fe6557fbc8340b5a",searchWord=dataInfo.q;break;case"www.google.com":cookieval="2c009312000456003fe7557fbd2534d53",searchWord=dataInfo.q;break;case"sm.cn":cookieval="2c009313000457003fe8557fbd9b32e30",searchWord=dataInfo.q}setcookie("sitefrom",cookieval,never.toGMTString())}}}var flag=!1,slideuptime,poptime,pop=$("#shop_cart"),mouseenterflag=!1,oh;$(document).ready(function(){logininfo(),$(".ShoppingCart").hover(function(e){e.stopPropagation(),mouseenterflag=!0,ajaxReq(mouseenterflag),oh=!0},function(e){e.stopPropagation();var o;o=0!=$("#cart_num").text()?$("#shop_cart"):$(".NoProducts"),slideuptime=setTimeout(function(){o.slideUp(400)},300),oh=!1}),pop.hover(function(){clearTimeout(slideuptime),clearTimeout(poptime),clearTimeout(mouseenterflag)},function(){poptime=setTimeout(function(){oh||pop.slideUp(400)},200)}),$("#cartpop").delegate("#reflash","click",function(e){e.preventDefault(),ajaxReq()}),$("#cart_num_box").click(function(){window.location.href="/cart"}),$("#shop_cart").delegate(".close","click",function(e){e.preventDefault();var o=$(this);$.ajax({url:"/instant/cart/removeCartItem",type:"POST",data:"row_id="+o.attr("row_id"),cache:!1,dataType:"json",success:function(e){o.parent().fadeOut(400,function(){o.parents("tr").remove(),genHtml(e)}),null!=e&&"undefined"!=typeof e.row_id?$("#cart_num").text(e.total_num):$("#cart_num").text("0")}})}),$(".pd").mouseover(function(){var e=$(this);e.addClass("currentHOver").find(".pullDownCon").show();var o=$(this).index();2==o&&e.find(".arrow").css({left:"8px"}),3==o&&e.find(".arrow").css({left:"50px",top:"19px"})}).mouseout(function(){var e=$(this);e.removeClass("currentHOver").find(".pullDownCon").hide();var o=$(this).index();2==o&&e.find(".arrow").css({left:"10px"}),3==o&&e.find(".arrow").css({left:"50px",top:"16px"})}),hpop()}),ajaxReq=function(e){$.ajax({url:"/instant/cart/getCartContents",type:"POST",dataType:"json",success:function(o){"undefined"!=typeof o.row_id?(genHtml(o),$("#shop_cart").slideDown(400,function(){flag=!0}),"undefined"==typeof e&&setTimeout(function(){$("#shop_cart").slideUp(400)},6500)):$(".NoProducts").slideDown(100,function(){})},error:function(){$(".NoProducts").empty().text('<div class="loading">载入购物车失败，请手动<a href="#" id="reflash">刷新</a></div>').fadeOut(400)}})},genHtml=function(e){if("undefined"!=typeof e.row_id){for(var o='<div class="title">最近加入的商品</div><div class="content">',t=0;t<e.row_id.length;t++){var s="/item-"+e.sku[t]+".html",a="";"SINGLE"!=e.size[t]&&(a=e.size[t]),o+='<div class="block"><table width="100%" border="0" cellpadding="0" cellspacing="0"><tr>',o+='<td width="17%" valign="top"><a href="'+s+'"><img src="'+e.img[t]+'" alt="'+e.name[t]+'" height="50" width="50"/></a></td><td width="61%" valign="middle"><div class="con"><a href="'+s+'">'+e.name[t]+"</a><br />"+a+'</div></td><td width="25%" valign="middle" class="tr"><span class="pink f14"><strong>&yen;'+e.cost[t]+"</strong></span>x"+e.num[t]+'<br><a href="javascript:void(0)" class="close pink" row_id="'+e.row_id[t]+'">删除</a></td></tr></table></div>'}1==e.more&&(o+='<p class="more"><a href="/cart" rel="nofollow">购物车内所有商品&gt;&gt;</a></p>'),o+='</div><div class="foot"><div class="settlement">共 <span class="pink ver blod">'+e.total_num+'</span> 件商品　共计<span class="pink ver f20">￥</span> <span class="pink ver blod f20">'+e.total_cost+'</span></div><div class="btn"><a href="/cart" class="btnSettlement" rel="nofollow" title="去购物车">去购物车结算</a></div>',$("#shop_cart").empty().append(o),$("#cart_num").text(e.total_num)}else $("#cart_num").text(e.total_num),$("#shop_cart").hide()};